@echo off
REM Batch script to simulate Git synchronization failure scenario
REM Recreate non-fast-forward error, resolve with fetch/merge, document steps, show successful push

echo Step 1: Set up directories and initialize bare remote repository
mkdir remote_repo
cd remote_repo
git init --bare
cd ..

echo Step 2: Clone the repository into two local directories (simulating two developers)
git clone remote_repo local1
git clone remote_repo local2

echo Step 3: In local1, add a file, commit, and push initial changes
cd local1
echo Initial content > test.txt
git add test.txt
git commit -m "Initial commit"
git push origin master

echo Step 4: In local2, modify the file, commit, and push (remote now has new commit)
cd ..\local2
echo Conflicting content from developer 2 > test.txt
git add test.txt
git commit -m "Modified by developer 2"
git push origin master

echo Step 5: In local1, modify the same file (creating conflict), commit locally
cd ..\local1
echo Conflicting content from developer 1 > test.txt
git add test.txt
git commit -m "Modified by developer 1"

echo Step 6: Attempt to push from local1 - this will fail with non-fast-forward error
git push origin master
REM Expected error: ! [rejected] master -> master (non-fast-forward)

echo Step 7: Resolve by fetching remote changes and merging (without losing data)
git fetch origin
git merge origin/master
REM If conflict occurs, resolve manually (in real scenario, edit file and commit)
REM For simulation, assume merge succeeds or handle conflict

echo Step 8: After resolution, push successfully
git push origin master

echo Resolution documented: Used 'git fetch' to get remote changes, 'git merge' to integrate without rebasing (preserves history), resolved any conflicts by editing files, then pushed.

echo Cleanup: Remove temp directories
cd ..
rmdir /s /q remote_repo local1 local2

echo Scenario completed successfully. All commands executed.
